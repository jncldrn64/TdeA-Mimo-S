<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Facturaci√≥n | Helados Mimo's</title>
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- CSS Custom de Mimo's -->
  <link rel="stylesheet" th:href="@{/css/mimos-style.css}">
</head>
<body>
  <div class="contenedor-central">
    <!-- HEADER -->
    <header>
      <a th:href="@{/catalogo}">
        <!-- NOTA: Logo Mimo's -->
        <img th:src="@{/img/logo-mimos.png}" alt="Logo Mimo's" id="logo" src="https://via.placeholder.com/150x100?text=LOGO+MIMOS">
      </a>
      <div id="barra-superior">
        <a href="#">
          <img th:src="@{/img/soporte-icon.svg}" alt="Soporte" src="https://via.placeholder.com/32?text=S">
          <span>Soporte</span>
        </a>
        <a th:href="@{/catalogo}">
          <img th:src="@{/img/catalogo-icon.svg}" alt="Cat√°logo" src="https://via.placeholder.com/32?text=C">
          <span>Cat√°logo</span>
        </a>
        <a th:href="@{/carrito}">
          <img th:src="@{/img/carrito-icon.svg}" alt="Carrito" src="https://via.placeholder.com/32?text=Ca">
          <span>Carrito</span>
        </a>
      </div>
    </header>

    <!-- CONTENIDO PRINCIPAL: FACTURACI√ìN -->
    <div class="contenido-facturacion">
      
      <!-- T√≠tulo -->
      <h1 class="titulo-facturacion">Facturaci√≥n</h1>
      <p class="subtitulo-facturacion">Ingresa los siguientes datos para generar tu factura</p>

      <!-- Mensaje de error si existe -->
      <div th:if="${error}" class="alert alert-danger alert-custom" role="alert">
        <p th:text="${error}">Error al generar factura</p>
      </div>

      <!-- FORMULARIO DE FACTURACI√ìN -->
      <form th:action="@{/factura/generar}" method="POST" class="form-facturacion">
        
        <!-- Campo oculto con ID del pedido -->
        <input type="hidden" name="idPedido" th:value="${idPedido}">

        <!-- N√öMERO DE PEDIDO (readonly, informativo) -->
        <div class="mb-3">
          <label for="numeroPedido" class="form-label label-facturacion">#Pedido</label>
          <input 
            type="text" 
            class="form-control input-facturacion input-readonly" 
            id="numeroPedido" 
            th:value="${idPedido}"
            readonly>
          <div class="form-text texto-ayuda">
            Este es el n√∫mero de tu pedido
          </div>
        </div>

        <!-- RAZ√ìN SOCIAL (Tipo de persona) -->
        <div class="mb-3">
          <label class="form-label label-facturacion">
            Raz√≥n social <span class="texto-obligatorio">*</span>
          </label>
          <div class="opciones-razon-social">
            <div class="form-check form-check-inline">
              <input 
                class="form-check-input" 
                type="radio" 
                name="razonSocial" 
                id="radioPersonaFisica" 
                value="PERSONA_FISICA"
                checked>
              <label class="form-check-label" for="radioPersonaFisica">
                Persona f√≠sica
              </label>
            </div>
            <div class="form-check form-check-inline">
              <input 
                class="form-check-input" 
                type="radio" 
                name="razonSocial" 
                id="radioPersonaMoral" 
                value="PERSONA_MORAL">
              <label class="form-check-label" for="radioPersonaMoral">
                Persona moral
              </label>
            </div>
          </div>
        </div>

        <!-- NOMBRE COMPLETO / RAZ√ìN SOCIAL -->
        <div class="mb-3">
          <label for="nombreCompleto" class="form-label label-facturacion">
            Nombre completo <span class="texto-obligatorio">*</span>
          </label>
          <input 
            type="text" 
            class="form-control input-facturacion" 
            id="nombreCompleto" 
            name="nombreCompleto" 
            placeholder="Nombre completo o raz√≥n social de la empresa"
            required
            th:value="${usuario.nombreCompleto}">
          <div class="form-text texto-ayuda">
            Para persona moral, ingresa el nombre legal de la empresa
          </div>
        </div>

        <!-- NIT / RFC / C√âDULA -->
        <div class="mb-3">
          <label for="nit" class="form-label label-facturacion">
            NIT / RFC / C√©dula <span class="texto-obligatorio">*</span>
          </label>
          <input 
            type="text" 
            class="form-control input-facturacion" 
            id="nit" 
            name="nit" 
            placeholder="123456789-0"
            required>
          <div class="form-text texto-ayuda">
            N√∫mero de identificaci√≥n fiscal
          </div>
        </div>

        <!-- DIRECCI√ìN FISCAL -->
        <div class="mb-3">
          <label class="form-label label-facturacion">
            Direcci√≥n <span class="texto-obligatorio">*</span>
          </label>

          <!-- Direcci√≥n de la calle -->
          <input 
            type="text" 
            class="form-control input-facturacion mb-2" 
            name="direccionCalle" 
            placeholder="Direcci√≥n de la calle"
            required
            th:value="${usuario.direccion}">

          <!-- Ciudad -->
          <div class="row">
            <div class="col-md-6 mb-2">
              <input 
                type="text" 
                class="form-control input-facturacion" 
                name="ciudad" 
                placeholder="Ciudad"
                required
                th:value="${usuario.ciudad}">
            </div>

            <!-- C√≥digo Postal -->
            <div class="col-md-6 mb-2">
              <input 
                type="text" 
                class="form-control input-facturacion" 
                name="codigoPostal" 
                placeholder="C√≥digo postal"
                pattern="[0-9]{5,6}"
                th:value="${usuario.codigoPostal}">
            </div>
          </div>

          <!-- Estado/Provincia -->
          <select 
            class="form-select input-facturacion" 
            name="estadoProvincia" 
            required>
            <option value="" selected>Estado/Provincia</option>
            <option value="Amazonas" th:selected="${usuario.estadoProvincia == 'Amazonas'}">Amazonas</option>
            <option value="Antioquia" th:selected="${usuario.estadoProvincia == 'Antioquia'}">Antioquia</option>
            <option value="Arauca" th:selected="${usuario.estadoProvincia == 'Arauca'}">Arauca</option>
            <option value="Atl√°ntico" th:selected="${usuario.estadoProvincia == 'Atl√°ntico'}">Atl√°ntico</option>
            <option value="Bol√≠var" th:selected="${usuario.estadoProvincia == 'Bol√≠var'}">Bol√≠var</option>
            <option value="Boyac√°" th:selected="${usuario.estadoProvincia == 'Boyac√°'}">Boyac√°</option>
            <option value="Caldas" th:selected="${usuario.estadoProvincia == 'Caldas'}">Caldas</option>
            <option value="Caquet√°" th:selected="${usuario.estadoProvincia == 'Caquet√°'}">Caquet√°</option>
            <option value="Casanare" th:selected="${usuario.estadoProvincia == 'Casanare'}">Casanare</option>
            <option value="Cauca" th:selected="${usuario.estadoProvincia == 'Cauca'}">Cauca</option>
            <option value="Cesar" th:selected="${usuario.estadoProvincia == 'Cesar'}">Cesar</option>
            <option value="Choc√≥" th:selected="${usuario.estadoProvincia == 'Choc√≥'}">Choc√≥</option>
            <option value="C√≥rdoba" th:selected="${usuario.estadoProvincia == 'C√≥rdoba'}">C√≥rdoba</option>
            <option value="Cundinamarca" th:selected="${usuario.estadoProvincia == 'Cundinamarca'}">Cundinamarca</option>
            <option value="Guain√≠a" th:selected="${usuario.estadoProvincia == 'Guain√≠a'}">Guain√≠a</option>
            <option value="Guaviare" th:selected="${usuario.estadoProvincia == 'Guaviare'}">Guaviare</option>
            <option value="Huila" th:selected="${usuario.estadoProvincia == 'Huila'}">Huila</option>
            <option value="La Guajira" th:selected="${usuario.estadoProvincia == 'La Guajira'}">La Guajira</option>
            <option value="Magdalena" th:selected="${usuario.estadoProvincia == 'Magdalena'}">Magdalena</option>
            <option value="Meta" th:selected="${usuario.estadoProvincia == 'Meta'}">Meta</option>
            <option value="Nari√±o" th:selected="${usuario.estadoProvincia == 'Nari√±o'}">Nari√±o</option>
            <option value="Norte de Santander" th:selected="${usuario.estadoProvincia == 'Norte de Santander'}">Norte de Santander</option>
            <option value="Putumayo" th:selected="${usuario.estadoProvincia == 'Putumayo'}">Putumayo</option>
            <option value="Quind√≠o" th:selected="${usuario.estadoProvincia == 'Quind√≠o'}">Quind√≠o</option>
            <option value="Risaralda" th:selected="${usuario.estadoProvincia == 'Risaralda'}">Risaralda</option>
            <option value="San Andr√©s y Providencia" th:selected="${usuario.estadoProvincia == 'San Andr√©s y Providencia'}">San Andr√©s y Providencia</option>
            <option value="Santander" th:selected="${usuario.estadoProvincia == 'Santander'}">Santander</option>
            <option value="Sucre" th:selected="${usuario.estadoProvincia == 'Sucre'}">Sucre</option>
            <option value="Tolima" th:selected="${usuario.estadoProvincia == 'Tolima'}">Tolima</option>
            <option value="Valle del Cauca" th:selected="${usuario.estadoProvincia == 'Valle del Cauca'}">Valle del Cauca</option>
            <option value="Vaup√©s" th:selected="${usuario.estadoProvincia == 'Vaup√©s'}">Vaup√©s</option>
            <option value="Vichada" th:selected="${usuario.estadoProvincia == 'Vichada'}">Vichada</option>
          </select>
        </div>

        <!-- TEL√âFONO -->
        <div class="mb-3">
          <label for="telefono" class="form-label label-facturacion">
            Tel√©fono <span class="texto-obligatorio">*</span>
          </label>
          <input 
            type="tel" 
            class="form-control input-facturacion" 
            id="telefono" 
            name="telefono" 
            placeholder="3001234567"
            pattern="[0-9]{10}"
            required
            th:value="${usuario.telefono}">
        </div>

        <!-- CORREO ELECTR√ìNICO -->
        <div class="mb-4">
          <label for="correoElectronico" class="form-label label-facturacion">
            Correo electr√≥nico <span class="texto-obligatorio">*</span>
          </label>
          <input 
            type="email" 
            class="form-control input-facturacion" 
            id="correoElectronico" 
            name="correoElectronico" 
            placeholder="ejemplo@correo.com"
            required
            th:value="${usuario.correoElectronico}">
          <div class="form-text texto-ayuda">
            Te enviaremos la factura a este correo
          </div>
        </div>

        <!-- NOTA SOBRE CAMPOS OBLIGATORIOS -->
        <div class="nota-campos">
          <p><span class="texto-obligatorio">*</span> Campos obligatorios</p>
        </div>

        <!-- BOTONES -->
        <div class="botones-facturacion">
          <button type="submit" class="btn btn-primary btn-mimo btn-enviar-datos">
            Enviar datos
          </button>
          <a th:href="@{/confirmacion/{id}(id=${idPedido})}" class="btn btn-secondary btn-mimo btn-omitir">
            Omitir factura
          </a>
        </div>
      </form>

      <!-- INFORMACI√ìN FISCAL -->
      <div class="info-fiscal">
        <p>
          üìÑ La factura se generar√° autom√°ticamente con IVA del 19% y se enviar√° a tu correo electr√≥nico.
        </p>
      </div>
    </div>

    <!-- FOOTER -->
    <footer>
      <div class="footer-links">
        <a href="#">Convenios</a>
        <a href="#">Encu√©ntranos</a>
        <a href="#">Trabaja con nosotros</a>
        <a href="#">Contacto</a>
        <a href="#">Pol√≠ticas</a>
      </div>
    </footer>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- JS m√≠nimo: Validaci√≥n de tel√©fono -->
  <script>
    // Validar formato de tel√©fono
    const inputTelefono = document.getElementById('telefono');
    if (inputTelefono) {
      inputTelefono.addEventListener('input', function(e) {
        this.value = this.value.replace(/[^0-9]/g, '');
        if (this.value.length > 10) {
          this.value = this.value.slice(0, 10);
        }
      });
    }

    // Validar NIT/RFC (solo alfanum√©ricos y gui√≥n)
    const inputNIT = document.getElementById('nit');
    if (inputNIT) {
      inputNIT.addEventListener('input', function(e) {
        this.value = this.value.replace(/[^0-9A-Za-z\-]/g, '');
      });
    }
  </script>
</body>
</html>
